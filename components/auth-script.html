<script>
    // Initialize Supabase client when config is loaded
    let supabase;
    
    // Listen for the configLoaded event from config-loader.js
    document.addEventListener('configLoaded', function() {
        console.log('Configuration loaded successfully');
        
        // Initialize Supabase with loaded configuration
        try {
            supabase = window.supabase.createClient(
                window.config.supabaseUrl,
                window.config.supabaseKey
            );
            
            if (supabase && supabase.auth) {
                checkAuthStatus();
            }
        } catch (error) {
            console.error('Failed to initialize Supabase client:', error);
        }
    });
    
    // Check authentication status and update menu links
    async function checkAuthStatus() {
        try {
            const { data: { session }, error } = await supabase.auth.getSession();
            
            if (error) {
                console.error('Error checking auth status:', error);
                return;
            }
            
            // Get all the sign in links (nav and footer)
            const navSignInLink = document.querySelector('#navSignIn');
            const footerSignInLink = document.querySelector('#footerSignIn');
            const navDashboardLink = document.querySelector('#navDashboard');
            const footerDashboardLink = document.querySelector('#footerDashboard');
            
            if (session) {
                // User is signed in, change links to "Sign Out"
                if (navSignInLink) {
                    navSignInLink.textContent = 'Sign Out';
                    navSignInLink.addEventListener('click', handleSignOut);
                    navSignInLink.href = '#'; // Prevent navigation
                }
                
                if (footerSignInLink) {
                    footerSignInLink.textContent = 'Sign Out';
                    footerSignInLink.addEventListener('click', handleSignOut);
                    footerSignInLink.href = '#'; // Prevent navigation
                }
                
                // Show Dashboard links
                if (navDashboardLink) {
                    navDashboardLink.style.display = '';
                }
                
                if (footerDashboardLink) {
                    footerDashboardLink.style.display = '';
                }
                
                console.log('User is signed in:', session.user.id);
            } else {
                // User is not signed in, ensure links are "Sign In"
                if (navSignInLink) {
                    navSignInLink.textContent = 'Sign In';
                    navSignInLink.href = 'auth.html';
                }
                
                if (footerSignInLink) {
                    footerSignInLink.textContent = 'Sign In';
                    footerSignInLink.href = 'auth.html';
                }
                
                // Hide Dashboard links
                if (navDashboardLink) {
                    navDashboardLink.style.display = 'none';
                }
                
                if (footerDashboardLink) {
                    footerDashboardLink.style.display = 'none';
                }
                
                console.log('User is not signed in');
            }
            
            // Mark the current page in the nav
            highlightCurrentPage();
        } catch (e) {
            console.error('Error in checkAuthStatus:', e);
        }
    }
    
    // Handle sign out
    async function handleSignOut(e) {
        e.preventDefault();
        
        try {
            const { error } = await supabase.auth.signOut();
            if (error) {
                console.error('Error signing out:', error);
            } else {
                console.log('User signed out successfully');
                // Reload page after sign out
                window.location.reload();
            }
        } catch (e) {
            console.error('Exception during sign out:', e);
        }
    }
    
    // Highlight current page in navigation
    function highlightCurrentPage() {
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';
        
        // Clear all active classes
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        // Set active class based on current page
        if (currentPage === 'index.html' || currentPage === '') {
            document.getElementById('nav-home')?.classList.add('active');
        } else if (currentPage === 'support.html') {
            document.getElementById('nav-support')?.classList.add('active');
        } else if (currentPage === 'privacy.html') {
            document.getElementById('nav-privacy')?.classList.add('active');
        } else if (currentPage === 'boxleague.html') {
            document.getElementById('nav-boxleague')?.classList.add('active');
        } else if (currentPage === 'guide.html') {
            document.getElementById('nav-guide')?.classList.add('active');
        }
    }
</script> 